<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CB POKER</title>
    <style>
        :root { --poker-green: #1a4a32; --gold: #ffd700; }
        body { background: #121212; color: white; font-family: sans-serif; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        #room-link { position: absolute; top: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 12px; text-align: center; width: 90%; }
        #poker-table { width: 80vw; height: 40vh; max-width: 500px; background: radial-gradient(circle, #2d6a4f 0%, #1b4332 100%); border: 10px solid #3d2b1f; border-radius: 200px; display: flex; align-items: center; justify-content: center; position: relative; }
        .controls { position: fixed; bottom: 30px; display: flex; gap: 10px; }
        button { padding: 12px 20px; border-radius: 20px; border: none; background: var(--gold); font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="room-link">正在启动游戏引擎... (如果长时间没反应，请刷新)</div>

<div id="poker-table">
    <div id="pot-display" style="font-size: 30px;">$0</div>
</div>

<div class="controls">
    <button id="betBtn">下注 $100</button>
</div>

<script type="module">
    // 直接从官方推荐的 CDN 导入
    import { insertCoin, onPlayerJoin, getState, setState, onStateChange } 
    from "https://cdn.jsdelivr.net/npm/playroomkit/dist/playroomkit.js";

    async function init() {
        const linkEl = document.getElementById("room-link");

        try {
            console.log("正在尝试连接 Playroom...");
            
            // 强制配置：显示大厅，并设置游戏 ID (可以使用任何字符串)
            await insertCoin({
                gameId: "cb-poker-2026", 
                skipLobby: false
            });

            console.log("连接成功！");
            linkEl.innerHTML = `已连接！房间链接: <span style="color:var(--gold)">${window.location.href}</span>`;

            // 同步底池
            onStateChange("pot", (val) => {
                document.getElementById("pot-display").innerText = `$${val || 0}`;
            });

            document.getElementById("betBtn").onclick = () => {
                const current = getState("pot") || 0;
                setState("pot", current + 100, true);
            };

        } catch (error) {
            console.error("初始化失败:", error);
            linkEl.innerText = "引擎启动失败，请尝试在无痕模式下打开或检查浏览器插件。";
        }
    }

    // 确保 DOM 加载后运行
    init();
</script>
</body>
</html>
